     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_load_eflags
     7 00000000                                 	EXTERN	_io_store_eflags
     8 00000000                                 	EXTERN	_memtest_sub
     9 00000000                                 	EXTERN	_load_cr0
    10 00000000                                 	EXTERN	_store_cr0
    11 00000000                                 [FILE "memory.c"]
    12                                          [SECTION .text]
    13 00000000                                 	GLOBAL	_memtest
    14 00000000                                 _memtest:
    15 00000000 55                              	PUSH	EBP
    16 00000001 89 E5                           	MOV	EBP,ESP
    17 00000003 56                              	PUSH	ESI
    18 00000004 53                              	PUSH	EBX
    19 00000005 31 F6                           	XOR	ESI,ESI
    20 00000007 E8 [00000000]                   	CALL	_io_load_eflags
    21 0000000C 0D 00040000                     	OR	EAX,262144
    22 00000011 50                              	PUSH	EAX
    23 00000012 E8 [00000000]                   	CALL	_io_store_eflags
    24 00000017 E8 [00000000]                   	CALL	_io_load_eflags
    25 0000001C 5A                              	POP	EDX
    26 0000001D A9 00040000                     	TEST	EAX,262144
    27 00000022 74 05                           	JE	L2
    28 00000024 BE 00000001                     	MOV	ESI,1
    29 00000029                                 L2:
    30 00000029 25 FFFBFFFF                     	AND	EAX,-262145
    31 0000002E 50                              	PUSH	EAX
    32 0000002F E8 [00000000]                   	CALL	_io_store_eflags
    33 00000034 58                              	POP	EAX
    34 00000035 89 F0                           	MOV	EAX,ESI
    35 00000037 84 C0                           	TEST	AL,AL
    36 00000039 75 31                           	JNE	L5
    37 0000003B                                 L3:
    38 0000003B FF 75 0C                        	PUSH	DWORD [12+EBP]
    39 0000003E FF 75 08                        	PUSH	DWORD [8+EBP]
    40 00000041 E8 [00000000]                   	CALL	_memtest_sub
    41 00000046 5A                              	POP	EDX
    42 00000047 89 C3                           	MOV	EBX,EAX
    43 00000049 59                              	POP	ECX
    44 0000004A 89 F0                           	MOV	EAX,ESI
    45 0000004C 84 C0                           	TEST	AL,AL
    46 0000004E 75 09                           	JNE	L6
    47 00000050                                 L4:
    48 00000050 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
    49 00000053 89 D8                           	MOV	EAX,EBX
    50 00000055 5B                              	POP	EBX
    51 00000056 5E                              	POP	ESI
    52 00000057 5D                              	POP	EBP
    53 00000058 C3                              	RET
    54 00000059                                 L6:
    55 00000059 E8 [00000000]                   	CALL	_load_cr0
    56 0000005E 25 9FFFFFFF                     	AND	EAX,-1610612737
    57 00000063 50                              	PUSH	EAX
    58 00000064 E8 [00000000]                   	CALL	_store_cr0
    59 00000069 58                              	POP	EAX
    60 0000006A EB E4                           	JMP	L4
    61 0000006C                                 L5:
    62 0000006C E8 [00000000]                   	CALL	_load_cr0
    63 00000071 0D 60000000                     	OR	EAX,1610612736
    64 00000076 50                              	PUSH	EAX
    65 00000077 E8 [00000000]                   	CALL	_store_cr0
    66 0000007C 5B                              	POP	EBX
    67 0000007D EB BC                           	JMP	L3
    68 0000007F                                 	GLOBAL	_memman_init
    69 0000007F                                 _memman_init:
    70 0000007F 55                              	PUSH	EBP
    71 00000080 89 E5                           	MOV	EBP,ESP
    72 00000082 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    73 00000085 C7 00 00000000                  	MOV	DWORD [EAX],0
    74 0000008B C7 40 04 00000000               	MOV	DWORD [4+EAX],0
    75 00000092 C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
    76 00000099 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
    77 000000A0 5D                              	POP	EBP
    78 000000A1 C3                              	RET
    79 000000A2                                 	GLOBAL	_memman_total
    80 000000A2                                 _memman_total:
    81 000000A2 55                              	PUSH	EBP
    82 000000A3 31 C0                           	XOR	EAX,EAX
    83 000000A5 89 E5                           	MOV	EBP,ESP
    84 000000A7 31 D2                           	XOR	EDX,EDX
    85 000000A9 8B 4D 08                        	MOV	ECX,DWORD [8+EBP]
    86 000000AC                                 L13:
    87 000000AC 03 44 D1 14                     	ADD	EAX,DWORD [20+ECX+EDX*8]
    88 000000B0 42                              	INC	EDX
    89 000000B1 81 FA 00000FFF                  	CMP	EDX,4095
    90 000000B7 76 F3                           	JBE	L13
    91 000000B9 5D                              	POP	EBP
    92 000000BA C3                              	RET
    93 000000BB                                 	GLOBAL	_memman_alloc
    94 000000BB                                 _memman_alloc:
    95 000000BB 55                              	PUSH	EBP
    96 000000BC 31 C9                           	XOR	ECX,ECX
    97 000000BE 89 E5                           	MOV	EBP,ESP
    98 000000C0 57                              	PUSH	EDI
    99 000000C1 56                              	PUSH	ESI
   100 000000C2 53                              	PUSH	EBX
   101 000000C3 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   102 000000C6 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   103 000000C9                                 L28:
   104 000000C9 8B 54 CB 14                     	MOV	EDX,DWORD [20+EBX+ECX*8]
   105 000000CD 39 F2                           	CMP	EDX,ESI
   106 000000CF 73 10                           	JAE	L32
   107 000000D1 41                              	INC	ECX
   108 000000D2 81 F9 00000FFF                  	CMP	ECX,4095
   109 000000D8 76 EF                           	JBE	L28
   110 000000DA 31 C0                           	XOR	EAX,EAX
   111 000000DC                                 L16:
   112 000000DC 5B                              	POP	EBX
   113 000000DD 5E                              	POP	ESI
   114 000000DE 5F                              	POP	EDI
   115 000000DF 5D                              	POP	EBP
   116 000000E0 C3                              	RET
   117 000000E1                                 L32:
   118 000000E1 8B 7C CB 10                     	MOV	EDI,DWORD [16+EBX+ECX*8]
   119 000000E5 8D 04 3E                        	LEA	EAX,DWORD [ESI+EDI*1]
   120 000000E8 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   121 000000EC 89 D0                           	MOV	EAX,EDX
   122 000000EE 29 F0                           	SUB	EAX,ESI
   123 000000F0 89 44 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EAX
   124 000000F4 85 C0                           	TEST	EAX,EAX
   125 000000F6 75 20                           	JNE	L22
   126 000000F8 8B 03                           	MOV	EAX,DWORD [EBX]
   127 000000FA 48                              	DEC	EAX
   128 000000FB 89 03                           	MOV	DWORD [EBX],EAX
   129 000000FD 39 C1                           	CMP	ECX,EAX
   130 000000FF 73 17                           	JAE	L22
   131 00000101 89 C6                           	MOV	ESI,EAX
   132 00000103                                 L27:
   133 00000103 8B 44 CB 18                     	MOV	EAX,DWORD [24+EBX+ECX*8]
   134 00000107 8B 54 CB 1C                     	MOV	EDX,DWORD [28+EBX+ECX*8]
   135 0000010B 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   136 0000010F 89 54 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EDX
   137 00000113 41                              	INC	ECX
   138 00000114 39 F1                           	CMP	ECX,ESI
   139 00000116 72 EB                           	JB	L27
   140 00000118                                 L22:
   141 00000118 89 F8                           	MOV	EAX,EDI
   142 0000011A EB C0                           	JMP	L16
   143 0000011C                                 	GLOBAL	_memman_alloc_4k
   144 0000011C                                 _memman_alloc_4k:
   145 0000011C 55                              	PUSH	EBP
   146 0000011D 89 E5                           	MOV	EBP,ESP
   147 0000011F 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   148 00000122 05 00000FFF                     	ADD	EAX,4095
   149 00000127 25 FFFFF000                     	AND	EAX,-4096
   150 0000012C 89 45 0C                        	MOV	DWORD [12+EBP],EAX
   151 0000012F 5D                              	POP	EBP
   152 00000130 EB 89                           	JMP	_memman_alloc
   153 00000132                                 	GLOBAL	_memman_free
   154 00000132                                 _memman_free:
   155 00000132 55                              	PUSH	EBP
   156 00000133 89 E5                           	MOV	EBP,ESP
   157 00000135 57                              	PUSH	EDI
   158 00000136 56                              	PUSH	ESI
   159 00000137 53                              	PUSH	EBX
   160 00000138 53                              	PUSH	EBX
   161 00000139 31 DB                           	XOR	EBX,EBX
   162 0000013B 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   163 0000013E 8B 37                           	MOV	ESI,DWORD [EDI]
   164 00000140 39 F3                           	CMP	EBX,ESI
   165 00000142 73 0E                           	JAE	L36
   166 00000144                                 L40:
   167 00000144 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   168 00000147 39 44 DF 10                     	CMP	DWORD [16+EDI+EBX*8],EAX
   169 0000014B 77 05                           	JA	L36
   170 0000014D 43                              	INC	EBX
   171 0000014E 39 F3                           	CMP	EBX,ESI
   172 00000150 72 F2                           	JB	L40
   173 00000152                                 L36:
   174 00000152 85 DB                           	TEST	EBX,EBX
   175 00000154 74 10                           	JE	L41
   176 00000156 8D 0C DF                        	LEA	ECX,DWORD [EDI+EBX*8]
   177 00000159 8B 51 0C                        	MOV	EDX,DWORD [12+ECX]
   178 0000015C 8B 41 08                        	MOV	EAX,DWORD [8+ECX]
   179 0000015F 01 D0                           	ADD	EAX,EDX
   180 00000161 3B 45 0C                        	CMP	EAX,DWORD [12+EBP]
   181 00000164 74 7A                           	JE	L64
   182 00000166                                 L41:
   183 00000166 39 F3                           	CMP	EBX,ESI
   184 00000168 73 0C                           	JAE	L50
   185 0000016A 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   186 0000016D 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   187 00000170 3B 44 DF 10                     	CMP	EAX,DWORD [16+EDI+EBX*8]
   188 00000174 74 5A                           	JE	L65
   189 00000176                                 L50:
   190 00000176 81 FE 00000FFF                  	CMP	ESI,4095
   191 0000017C 7F 44                           	JG	L52
   192 0000017E 89 75 F0                        	MOV	DWORD [-16+EBP],ESI
   193 00000181 39 DE                           	CMP	ESI,EBX
   194 00000183 76 1A                           	JBE	L62
   195 00000185 8D 4C F7 10                     	LEA	ECX,DWORD [16+EDI+ESI*8]
   196 00000189                                 L57:
   197 00000189 8B 41 F8                        	MOV	EAX,DWORD [-8+ECX]
   198 0000018C 8B 51 FC                        	MOV	EDX,DWORD [-4+ECX]
   199 0000018F FF 4D F0                        	DEC	DWORD [-16+EBP]
   200 00000192 89 01                           	MOV	DWORD [ECX],EAX
   201 00000194 89 51 04                        	MOV	DWORD [4+ECX],EDX
   202 00000197 83 E9 08                        	SUB	ECX,8
   203 0000019A 39 5D F0                        	CMP	DWORD [-16+EBP],EBX
   204 0000019D 77 EA                           	JA	L57
   205 0000019F                                 L62:
   206 0000019F 8D 46 01                        	LEA	EAX,DWORD [1+ESI]
   207 000001A2 89 07                           	MOV	DWORD [EDI],EAX
   208 000001A4 39 47 04                        	CMP	DWORD [4+EDI],EAX
   209 000001A7 7D 03                           	JGE	L58
   210 000001A9 89 47 04                        	MOV	DWORD [4+EDI],EAX
   211 000001AC                                 L58:
   212 000001AC 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   213 000001AF 89 44 DF 10                     	MOV	DWORD [16+EDI+EBX*8],EAX
   214 000001B3 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   215 000001B6 89 44 DF 14                     	MOV	DWORD [20+EDI+EBX*8],EAX
   216 000001BA                                 L63:
   217 000001BA 31 C0                           	XOR	EAX,EAX
   218 000001BC                                 L34:
   219 000001BC 59                              	POP	ECX
   220 000001BD 5B                              	POP	EBX
   221 000001BE 5E                              	POP	ESI
   222 000001BF 5F                              	POP	EDI
   223 000001C0 5D                              	POP	EBP
   224 000001C1 C3                              	RET
   225 000001C2                                 L52:
   226 000001C2 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   227 000001C5 FF 47 0C                        	INC	DWORD [12+EDI]
   228 000001C8 01 47 08                        	ADD	DWORD [8+EDI],EAX
   229 000001CB 83 C8 FF                        	OR	EAX,-1
   230 000001CE EB EC                           	JMP	L34
   231 000001D0                                 L65:
   232 000001D0 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   233 000001D3 89 44 DF 10                     	MOV	DWORD [16+EDI+EBX*8],EAX
   234 000001D7 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   235 000001DA 01 44 DF 14                     	ADD	DWORD [20+EDI+EBX*8],EAX
   236 000001DE EB DA                           	JMP	L63
   237 000001E0                                 L64:
   238 000001E0 03 55 10                        	ADD	EDX,DWORD [16+EBP]
   239 000001E3 89 51 0C                        	MOV	DWORD [12+ECX],EDX
   240 000001E6 3B 1F                           	CMP	EBX,DWORD [EDI]
   241 000001E8 73 D0                           	JAE	L63
   242 000001EA 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   243 000001ED 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   244 000001F0 3B 44 DF 10                     	CMP	EAX,DWORD [16+EDI+EBX*8]
   245 000001F4 75 C4                           	JNE	L63
   246 000001F6 03 54 DF 14                     	ADD	EDX,DWORD [20+EDI+EBX*8]
   247 000001FA 89 51 0C                        	MOV	DWORD [12+ECX],EDX
   248 000001FD 8B 07                           	MOV	EAX,DWORD [EDI]
   249 000001FF 48                              	DEC	EAX
   250 00000200 89 07                           	MOV	DWORD [EDI],EAX
   251 00000202 39 C3                           	CMP	EBX,EAX
   252 00000204 73 B4                           	JAE	L63
   253 00000206 89 C1                           	MOV	ECX,EAX
   254 00000208                                 L49:
   255 00000208 8B 44 DF 18                     	MOV	EAX,DWORD [24+EDI+EBX*8]
   256 0000020C 8B 54 DF 1C                     	MOV	EDX,DWORD [28+EDI+EBX*8]
   257 00000210 89 44 DF 10                     	MOV	DWORD [16+EDI+EBX*8],EAX
   258 00000214 89 54 DF 14                     	MOV	DWORD [20+EDI+EBX*8],EDX
   259 00000218 43                              	INC	EBX
   260 00000219 39 CB                           	CMP	EBX,ECX
   261 0000021B 72 EB                           	JB	L49
   262 0000021D EB 9B                           	JMP	L63
   263 0000021F                                 	GLOBAL	_memman_free_4k
   264 0000021F                                 _memman_free_4k:
   265 0000021F 55                              	PUSH	EBP
   266 00000220 89 E5                           	MOV	EBP,ESP
   267 00000222 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   268 00000225 05 00000FFF                     	ADD	EAX,4095
   269 0000022A 25 FFFFF000                     	AND	EAX,-4096
   270 0000022F 89 45 10                        	MOV	DWORD [16+EBP],EAX
   271 00000232 5D                              	POP	EBP
   272 00000233 E9 FFFFFEFA                     	JMP	_memman_free
